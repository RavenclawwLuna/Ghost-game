<!DOCTYPE html>
<html>
<head>
  <title>Ghost Afterlife Obby</title>
  <style>
    body {
      margin: 0;
      background: #0b0b14;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-family: monospace;
      overflow: hidden;
    }
    canvas {
      border: 4px solid white;
      background: #111;
    }
  </style>
</head>
<body>

<canvas id="game" width="640" height="360"></canvas>

<script>
window.onload = function() {
  const canvas = document.getElementById("game");
  const ctx = canvas.getContext("2d");

  /* ---------- GAME STATE ---------- */
  let state = "intro"; // intro, play, heaven, hell, human
  let keys = {};
  let jumpRequest = false;
  let safeFrames = 0;

  /* ---------- PLAYER ---------- */
  const GRAVITY = 0.5;
  let player = { x:80, y:260, w:16, h:16, vy:0, onGround:false };
  let level = 0;

  /* ---------- LEVELS ---------- */
  const levels = [
    // START
    { blocks:[{x:0,y:300,w:640,h:60},{x:180,y:260,w:80,h:20},{x:300,y:230,w:80,h:20}],
      portals:[{x:520,y:260,w:20,h:40,type:"hell"},{x:40,y:260,w:20,h:40,to:2}] },
    // FAKE HEAVEN
    { blocks:[{x:0,y:300,w:640,h:60},{x:200,y:250,w:60,h:20},{x:300,y:210,w:60,h:20}],
      portals:[{x:460,y:260,w:20,h:40,type:"hell"}] },
    // SECRET UP PATH
    { blocks:[{x:0,y:300,w:640,h:60},{x:260,y:260,w:60,h:20}],
      portals:[{x:320,y:180,w:20,h:40,type:"human"}] },
    // HELL ROOM
    { blocks:[{x:0,y:300,w:640,h:60},{x:240,y:260,w:160,h:20}],
      portals:[{x:520,y:260,w:20,h:40,type:"hell"}] },
    // PIT TRAP
    { blocks:[{x:0,y:300,w:640,h:60}],
      portals:[{x:300,y:260,w:20,h:40,to:3}] },
    // HELL MAZE
    { blocks:[{x:0,y:300,w:640,h:60},{x:100,y:260,w:80,h:20},{x:260,y:220,w:80,h:20},{x:420,y:180,w:80,h:20}],
      portals:[{x:560,y:140,w:20,h:40,to:7},{x:40,y:260,w:20,h:40,type:"hell"}] },
    // TRUE HEAVEN
    { blocks:[{x:0,y:300,w:640,h:60},{x:240,y:260,w:80,h:20},{x:320,y:230,w:80,h:20}],
      portals:[{x:340,y:190,w:20,h:40,type:"heaven"}] }
  ];

  /* ---------- HELPERS ---------- */
  function hit(a,b){ return a.x<a.x+b.w && a.x+a.w>b.x && a.y<b.y+b.h && a.y+a.h>b.y; }
  function reset(){ player.x=80; player.y=260; player.vy=0; player.onGround=false; }

  /* ---------- INPUT ---------- */
  window.addEventListener("keydown", e=>{
    keys[e.code]=true;
    if(state==="intro" && e.code==="Space"){ state="play"; safeFrames=10; reset(); }
    if(e.code==="Space") jumpRequest=true;
  });
  window.addEventListener("keyup", e=>keys[e.code]=false);

  /* ---------- UPDATE ---------- */
  function update(){
    if(state!=="play") return;

    if(keys["KeyA"]) player.x-=2;
    if(keys["KeyD"]) player.x+=2;

    player.vy+=GRAVITY;
    player.y+=player.vy;
    player.onGround=false;

    levels[level].blocks.forEach(b=>{
      if(player.x < b.x+b.w && player.x+player.w > b.x && player.y < b.y+b.h && player.y+player.h > b.y && player.vy>=0){
        player.y=b.y-player.h;
        player.vy=0;
        player.onGround=true;
      }
    });

    if(jumpRequest && player.onGround) player.vy=-9;
    jumpRequest=false;

    if(safeFrames>0){ safeFrames--; return; }

    levels[level].portals.forEach(p=>{
      if(player.x<p.x+p.w && player.x+player.w>p.x && player.y<p.y+p.h && player.y+player.h>p.y){
        if(p.type==="hell"){ state="hell"; }
        else if(p.type==="heaven"){ state="heaven"; }
        else if(p.type==="human"){ state="human"; }
        else if(p.to!==undefined){ level=p.to; reset(); }
      }
    });

    // Edge transitions
    if(player.x<-20){ level=2; reset(); }
    if(player.x>canvas.width){ level=5; reset(); }
    if(player.y>canvas.height){ level=3; reset(); }
    if(player.y<-20){ level=2; reset(); }
  }

  /* ---------- DRAW ---------- */
  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    if(state==="intro"){
      ctx.fillStyle="#fff";
      ctx.textAlign="center";
      ctx.font="16px monospace";
      ctx.fillText("You are a ghost.",320,120);
      ctx.fillText("Your soul must find the true Heaven.",320,150);
      ctx.fillText("Paths can mislead. Wrong choices = Hell.",320,180);
      ctx.fillText("A / D move, SPACE jump",320,210);
      ctx.fillText("Press SPACE to begin",320,260);
      return;
    }

    if(state==="heaven"){
      ctx.fillStyle="white";
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle="#000";
      ctx.textAlign="center";
      ctx.font="24px monospace";
      ctx.fillText("âœ¨ Heaven âœ¨",320,150);
      ctx.font="16px monospace";
      ctx.fillText("You found the true Heaven.",320,180);
      ctx.fillText("Three possible endings: Heaven, Hell, Human Realm",320,210);
      return;
    }

    if(state==="hell"){
      ctx.fillStyle="#ff4444";
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle="#000";
      ctx.textAlign="center";
      ctx.font="24px monospace";
      ctx.fillText("ðŸ”¥ Hell ðŸ”¥",320,150);
      ctx.font="16px monospace";
      ctx.fillText("You were misled and judged.",320,180);
      ctx.fillText("Three possible endings: Heaven, Hell, Human Realm",320,210);
      return;
    }

    if(state==="human"){
      ctx.fillStyle="#3399ff";
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle="#fff";
      ctx.textAlign="center";
      ctx.font="24px monospace";
      ctx.fillText("ðŸŒŒ Human Realm ðŸŒŒ",320,150);
      ctx.font="16px monospace";
      ctx.fillText("You returned to the human world.",320,180);
      ctx.fillText("Three possible endings: Heaven, Hell, Human Realm",320,210);
      return;
    }

    // Playing game
    ctx.fillStyle="#ddd";
    ctx.fillRect(player.x,player.y,player.w,player.h);
    ctx.fillStyle="#444";
    levels[level].blocks.forEach(b=>ctx.fillRect(b.x,b.y,b.w,b.h));
    levels[level].portals.forEach(p=>{
      ctx.fillStyle=p.type==="heaven"?"#7fffd4":p.type==="hell"?"#ff4444":"#aaa";
      ctx.fillRect(p.x,p.y,p.w,p.h);
    });
    ctx.fillStyle="#fff";
    ctx.font="12px monospace";
    ctx.fillText("A / D move, SPACE jump",10,20);
  }

  /* ---------- LOOP ---------- */
  function loop(){
    update();
    draw();
    requestAnimationFrame(loop);
  }
  loop();
};
</script>

</body>
</html>
