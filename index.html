<!DOCTYPE html>
<html>
<head>
  <title>Ghost Obby</title>
  <style>
    body {
      margin: 0;
      background: #0b0b14;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      image-rendering: pixelated;
    }
    canvas {
      border: 4px solid white;
      background: #111;
    }
  </style>
</head>
<body>

<canvas id="game" width="640" height="360"></canvas>

<script>
const c = document.getElementById("game");
const ctx = c.getContext("2d");

let k = {};
document.addEventListener("keydown", e => k[e.key] = true);
document.addEventListener("keyup", e => k[e.key] = false);

const g = 0.5;

let p = {
  x: 40, y: 260, w: 16, h: 16,
  vy: 0, onG: false
};

let lvl = 0;

const levels = [
  // LEVEL 0 — INTRO + CHOICE
  {
    blocks: [
      {x:0,y:300,w:640,h:60},
      {x:120,y:260,w:80,h:20},
      {x:260,y:230,w:80,h:20},
      {x:400,y:200,w:80,h:20}
    ],
    portals: [
      {x:520,y:260,w:20,h:40,to:1}, // upper path
      {x:520,y:220,w:20,h:40,to:2}  // lower path
    ]
  },

  // LEVEL 1 — HARD BUT HEAVEN
  {
    blocks: [
      {x:0,y:300,w:640,h:60},
      {x:140,y:260,w:60,h:20},
      {x:260,y:220,w:60,h:20},
      {x:380,y:180,w:60,h:20}
    ],
    portals: [
      {x:520,y:160,w:20,h:40,type:"heaven"}
    ]
  },

  // LEVEL 2 — EASY BUT HELL
  {
    blocks: [
      {x:0,y:300,w:640,h:60},
      {x:200,y:260,w:120,h:20}
    ],
    portals: [
      {x:520,y:260,w:20,h:40,type:"hell"}
    ]
  }
];

function hit(a,b){
  return a.x < b.x+b.w && a.x+a.w > b.x &&
         a.y < b.y+b.h && a.y+a.h > b.y;
}

function reset(){
  p.x = 40;
  p.y = 260;
  p.vy = 0;
}

function update(){
  // movement
  if(k["a"]) p.x -= 2;
  if(k["d"]) p.x += 2;

  // gravity
  p.vy += g;
  p.y += p.vy;
  p.onG = false;

  // collision
  levels[lvl].blocks.forEach(b=>{
    if(hit(p,b) && p.vy >= 0){
      p.y = b.y - p.h;
      p.vy = 0;
      p.onG = true;
    }
  });

  // jump (AFTER collision = FIX)
  if(k["w"] && p.onG){
    p.vy = -8;
  }

  // portals
  levels[lvl].portals.forEach(o=>{
