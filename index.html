<!DOCTYPE html>
<html>
<head>
  <title>Ghost Afterlife Obby</title>
  <style>
    body{
      margin:0;
      background: radial-gradient(circle at top, #14162a, #070711);
      display:flex;
      justify-content:center;
      align-items:center;
      height:100vh;
      font-family:monospace;
      overflow:hidden;
    }
    canvas{
      border:3px solid rgba(255,255,255,0.8);
      border-radius:14px;
      background: rgba(0,0,0,0.35);
      image-rendering: pixelated;
      box-shadow: 0 0 30px rgba(180,120,255,0.18);
    }
  </style>
</head>
<body>

<canvas id="game" width="640" height="360"></canvas>

<script>
window.onload = function(){
  const canvas = document.getElementById("game");
  const ctx = canvas.getContext("2d");

  /* ---------- GAME STATE ---------- */
  let state = "intro"; // intro, play, blob, heaven, hell, human
  let keys = {};
  let jumpRequest = false;

  /* ---------- PLAYER ---------- */
  const GRAVITY = 0.5;
  let player = { x:80, y:260, w:16, h:18, vy:0, onGround:false };
  let level = 0;
  let respawn = { x:80, y:260 };
  let t = 0; // timer for aesthetics

  /* ---------- BLOB CHOICE ---------- */
  let blobChoice = 0; // 0 none, 1, 2, 3
  let blobCooldown = 0;

  /* ---------- LEVELS ---------- */
  // Each level: blocks, portals, voids, blobs, spikes, respawn
  const levels = [
    // 0 START ROOM
    {
      name:"Start",
      blocks:[
        {x:0,y:300,w:640,h:60},
        {x:140,y:260,w:90,h:18},
        {x:270,y:232,w:90,h:18},
        {x:400,y:204,w:90,h:18},
        {x:0,y:165,w:70,h:18} // secret ledge
      ],
      portals:[
        {x:620,y:260,w:20,h:40,to:1},
        {x:0,y:260,w:20,h:40,to:2}
      ],
      voids:[
        {x:230,y:300,w:70,h:60}
      ],
      spikes:[
        {x:330,y:292,w:60,h:8}
      ],
      blobs:[
        {x:520,y:282,w:18,h:18}
      ],
      respawn:{x:80,y:260}
    },

    // 1 TRAP HALL
    {
      name:"Trap Hall",
      blocks:[
        {x:0,y:300,w:640,h:60},
        {x:100,y:265,w:60,h:18},
        {x:220,y:245,w:60,h:18},
        {x:340,y:225,w:60,h:18},
        {x:460,y:205,w:60,h:18}
      ],
      portals:[
        {x:620,y:260,w:20,h:40,to:3},
        {x:0,y:260,w:20,h:40,to:0}
      ],
      voids:[
        {x:290,y:300,w:120,h:60}
      ],
      spikes:[
        {x:170,y:292,w:40,h:8},
        {x:420,y:292,w:40,h:8}
      ],
      blobs:[],
      respawn:{x:40,y:260}
    },

    // 2 STAIRWAY ROOM (Heaven reachable)
    {
      name:"Stairway",
      blocks:[
        {x:0,y:300,w:640,h:60},
        {x:120,y:272,w:60,h:18},
        {x:200,y:244,w:60,h:18},
        {x:280,y:216,w:60,h:18},
        {x:360,y:188,w:60,h:18},
        {x:440,y:160,w:90,h:18},
        {x:520,y:240,w:70,h:18}
      ],
      portals:[
        {x:570,y:110,w:20,h:40,type:"heaven"},
        {x:620,y:260,w:20,h:40,to:0}
      ],
      voids:[
        {x:0,y:300,w:60,h:60}
      ],
      spikes:[
        {x:250,y:292,w:50,h:8}
      ],
      blobs:[],
      respawn:{x:40,y:260}
    },

    // 3 HELL MAZE
    {
      name:"Hell Maze",
      blocks:[
        {x:0,y:300,w:640,h:60},
        {x:80,y:262,w:90,h:18},
        {x:210,y:222,w:90,h:18},
        {x:340,y:182,w:90,h:18},
        {x:470,y:222,w:90,h:18},
        {x:560,y:262,w:70,h:18}
      ],
      portals:[
        {x:600,y:240,w:20,h:60,type:"hell"},
        {x:20,y:240,w:20,h:60,type:"hell"},
        {x:620,y:40,w:20,h:40,type:"hell"},
        {x:0,y:260,w:20,h:40,to:1},
        {x:620,y:260,w:20,h:40,to:4}
      ],
      voids:[
        {x:260,y:300,w:120,h:60},
        {x:470,y:300,w:80,h:60}
      ],
      spikes:[
        {x:120,y:292,w:40,h:8},
        {x:300,y:292,w:40,h:8},
        {x:520,y:292,w:40,h:8}
      ],
      blobs:[],
      respawn:{x:40,y:260}
    },

    // 4 BLOB CHAMBER (choices lead to rooms)
    {
      name:"Blob Chamber",
      blocks:[
        {x:0,y:300,w:640,h:60},
        {x:200,y:250,w:80,h:18},
        {x:360,y:220,w:80,h:18}
      ],
      portals:[
        {x:0,y:260,w:20,h:40,to:3}
      ],
      voids:[
        {x:280,y:300,w:80,h:60}
      ],
      spikes:[
        {x:100,y:292,w:60,h:8},
        {x:500,y:292,w:60,h:8}
      ],
      blobs:[
        {x:310,y:282,w:18,h:18}
      ],
      respawn:{x:40,y:260}
    },

    // 5 ROOM FROM BLOB CHOICE 1 (Heaven-ish route)
    {
      name:"Soft Light",
      blocks:[
        {x:0,y:300,w:640,h:60},
        {x:160,y:260,w:100,h:18},
        {x:320,y:220,w:100,h:18},
        {x:480,y:180,w:100,h:18}
      ],
      portals:[
        {x:620,y:260,w:20,h:40,to:2}
      ],
      voids:[],
      spikes:[
        {x:250,y:292,w:60,h:8}
      ],
      blobs:[],
      respawn:{x:40,y:260}
    },

    // 6 ROOM FROM BLOB CHOICE 2 (Hell-ish route)
    {
      name:"Ash Pit",
      blocks:[
        {x:0,y:300,w:640,h:60},
        {x:80,y:250,w:90,h:18},
        {x:220,y:210,w:90,h:18},
        {x:360,y:250,w:90,h:18},
        {x:500,y:210,w:90,h:18}
      ],
      portals:[
        {x:620,y:260,w:20,h:40,to:3}
      ],
      voids:[
        {x:140,y:300,w:80,h:60},
        {x:420,y:300,w:80,h:60}
      ],
      spikes:[
        {x:300,y:292,w:60,h:8}
      ],
      blobs:[],
      respawn:{x:40,y:260}
    },

    // 7 ROOM FROM BLOB CHOICE 3 (back to start secret)
    {
      name:"Forgotten Hall",
      blocks:[
        {x:0,y:300,w:640,h:60},
        {x:260,y:260,w:120,h:18},
        {x:0,y:220,w:80,h:18}
      ],
      portals:[
        {x:0,y:260,w:20,h:40,to:0}
      ],
      voids:[],
      spikes:[
        {x:400,y:292,w:80,h:8}
      ],
      blobs:[],
      respawn:{x:40,y:260}
    }
  ];

  /* ---------- INPUT ---------- */
  window.addEventListener("keydown", e=>{
    keys[e.code]=true;

    if(state==="intro" && e.code==="Space"){
      state="play";
      resetToLevel(0);
    }

    if(e.code==="Space") jumpRequest=true;

    // blob menu
    if(state==="blob"){
      if(e.code==="Digit1") blobChoice = 1;
      if(e.code==="Digit2") blobChoice = 2;
      if(e.code==="Digit3") blobChoice = 3;
      if(e.code==="Escape"){
        state="play";
        blobChoice = 0;
      }
    }
  });
  window.addEventListener("keyup", e=>keys[e.code]=false);

  function resetToLevel(lv){
    level = lv;
    player.x = levels[level].respawn.x;
    player.y = levels[level].respawn.y;
    player.vy = 0;
    player.onGround = false;
    respawn.x = player.x;
    respawn.y = player.y;
  }

  function respawnPlayer(){
    // spikes send to start room
    resetToLevel(0);
  }

  function softRespawn(){
    // void sends to room respawn
    player.x = respawn.x;
    player.y = respawn.y;
    player.vy = 0;
    player.onGround = false;
  }

  /* ---------- COLLISION ---------- */
  function rectHit(a,b){
    return a.x < b.x+b.w && a.x+a.w > b.x &&
           a.y < b.y+b.h && a.y+a.h > b.y;
  }

  /* ---------- UPDATE ---------- */
  function update(){
    t++;

    if(state!=="play") return;

    // movement
    if(keys["KeyA"]) player.x -= 2.2;
    if(keys["KeyD"]) player.x += 2.2;

    // gravity
    player.vy += GRAVITY;
    player.y += player.vy;
    player.onGround = false;

    // blocks collision
    for(const b of levels[level].blocks){
      if(rectHit(player,b)){
        if(player.vy >= 0 && player.y + player.h - player.vy <= b.y + 6){
          player.y = b.y - player.h;
          player.vy = 0;
          player.onGround = true;

          // set respawn when safely landing
          respawn.x = player.x;
          respawn.y = player.y;
        }
      }
    }

    // jump
    if(jumpRequest && player.onGround){
      player.vy = -9.5;
    }
    jumpRequest = false;

    // rare human realm: touch TOP EDGE
    if(player.y <= 0){
      state = "human";
      return;
    }

    // void traps: soft respawn
    for(const v of levels[level].voids){
      if(rectHit(player,v)){
        softRespawn();
        return;
      }
    }

    // spikes: hard reset to start
    for(const s of levels[level].spikes){
      if(rectHit(player,s)){
        respawnPlayer();
        return;
      }
    }

    // blob interaction
    if(blobCooldown>0) blobCooldown--;
    for(const bl of levels[level].blobs){
      if(rectHit(player,bl) && blobCooldown===0){
        state="blob";
        blobChoice=0;
        blobCooldown = 40;
        return;
      }
    }

    // portals
    for(const p of levels[level].portals){
      if(rectHit(player,p)){
        if(p.type==="heaven"){ state="heaven"; return; }
        if(p.type==="hell"){ state="hell"; return; }
        if(p.to!==undefined){ resetToLevel(p.to); return; }
      }
    }

    // fall -> hell
    if(player.y > canvas.height + 50){
      state = "hell";
      return;
    }
  }

  /* ---------- BLOB LOGIC ---------- */
  function updateBlob(){
    if(state!=="blob") return;

    // all answers lead to different rooms
    if(blobChoice===1){
      state="play";
      resetToLevel(5);
      blobChoice=0;
    }else if(blobChoice===2){
      state="play";
      resetToLevel(6);
      blobChoice=0;
    }else if(blobChoice===3){
      state="play";
      resetToLevel(7);
      blobChoice=0;
    }
  }

  /* ---------- DRAW HELPERS ---------- */
  function drawPlatform(b){
    // aesthetic platform
    ctx.fillStyle = "rgba(255,255,255,0.10)";
    ctx.fillRect(b.x,b.y,b.w,b.h);
    ctx.strokeStyle = "rgba(255,255,255,0.25)";
    ctx.strokeRect(b.x+0.5,b.y+0.5,b.w-1,b.h-1);
  }

  function drawGlowCircle(x,y,r,alpha){
    ctx.beginPath();
    ctx.fillStyle = "rgba(190,140,255,"+alpha+")";
    ctx.arc(x,y,r,0,Math.PI*2);
    ctx.fill();
  }

  function drawSpikes(s){
    // triangle spikes
    const count = Math.max(2, Math.floor(s.w/10));
    const w = s.w / count;
    for(let i=0;i<count;i++){
      const x = s.x + i*w;
      ctx.beginPath();
      ctx.fillStyle="rgba(255,90,120,0.9)";
      ctx.moveTo(x, s.y+s.h);
      ctx.lineTo(x+w/2, s.y);
      ctx.lineTo(x+w, s.y+s.h);
      ctx.closePath();
      ctx.fill();
    }
  }

  /* ---------- DRAW ---------- */
  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // background gradient
    const g = ctx.createLinearGradient(0,0,0,canvas.height);
    g.addColorStop(0,"rgba(40,30,80,0.6)");
    g.addColorStop(1,"rgba(5,5,15,1)");
    ctx.fillStyle=g;
    ctx.fillRect(0,0,canvas.width,canvas.height);

    // particles
    for(let i=0;i<25;i++){
      const px = (i*97 + t*0.3) % canvas.width;
      const py = (i*53 + t*0.15) % canvas.height;
      ctx.fillStyle="rgba(255,255,255,0.08)";
      ctx.fillRect(px,py,2,2);
    }

    if(state==="intro"){
      ctx.fillStyle="rgba(0,0,0,0.35)";
      ctx.fillRect(80,60,480,250);

      ctx.fillStyle="#fff";
      ctx.textAlign="center";
      ctx.font="20px monospace";
      ctx.fillText("GHOST AFTERLIFE OBBY", canvas.width/2, 105);

      ctx.font="14px monospace";
      ctx.fillText("You died... and woke up as a ghost.", canvas.width/2, 150);
      ctx.fillText("Find the TRUE Heaven door. Wrong paths lead to Hell.", canvas.width/2, 175);
      ctx.fillText("Touching the TOP edge is extremely rare...", canvas.width/2, 200);
      ctx.fillText("Try to get all 3 endings!", canvas.width/2, 225);

      ctx.fillText("Controls: A/D move   SPACE jump", canvas.width/2, 260);
      ctx.fillText("Press SPACE to begin", canvas.width/2, 285);
      return;
    }

    if(state==="heaven"){
      ctx.fillStyle="white";
      ctx.fillRect(0,0,canvas.width,canvas.height);

      ctx.textAlign="center";
      ctx.fillStyle="#111";
      ctx.font="30px monospace";
      ctx.fillText("âœ¨ HEAVEN âœ¨", canvas.width/2, 135);

      ctx.font="16px monospace";
      ctx.fillText("You found the TRUE door.", canvas.width/2, 175);
      ctx.fillText("Try to get all 3 endings!", canvas.width/2, 205);
      ctx.fillText("Endings: Heaven / Hell / Human Realm", canvas.width/2, 230);
      ctx.fillText("Refresh to play again.", canvas.width/2, 270);
      return;
    }

    if(state==="hell"){
      ctx.fillStyle="#ff2f2f";
      ctx.fillRect(0,0,canvas.width,canvas.height);

      ctx.textAlign="center";
      ctx.fillStyle="#000";
      ctx.font="30px monospace";
      ctx.fillText("ðŸ”¥ HELL ðŸ”¥", canvas.width/2, 135);

      ctx.font="16px monospace";
      ctx.fillText("You chose the wrong path.", canvas.width/2, 175);
      ctx.fillText("Try to get all 3 endings!", canvas.width/2, 205);
      ctx.fillText("Endings: Heaven / Hell / Human Realm", canvas.width/2, 230);
      ctx.fillText("Refresh to try again.", canvas.width/2, 270);
      return;
    }

    if(state==="human"){
      ctx.fillStyle="#2b6cff";
      ctx.fillRect(0,0,canvas.width,canvas.height);

      ctx.textAlign="center";
      ctx.fillStyle="#fff";
      ctx.font="28px monospace";
      ctx.fillText("ðŸŒŒ HUMAN REALM ðŸŒŒ", canvas.width/2, 135);

      ctx.font="16px monospace";
      ctx.fillText("Impossible... you escaped judgment.", canvas.width/2, 175);
      ctx.fillText("This ending is rare.", canvas.width/2, 200);
      ctx.fillText("Try to get all 3 endings!", canvas.width/2, 230);
      ctx.fillText("Refresh to play again.", canvas.width/2, 270);
      return;
    }

    if(state==="blob"){
      ctx.fillStyle="rgba(0,0,0,0.55)";
      ctx.fillRect(70,70,500,220);

      ctx.textAlign="center";
      ctx.fillStyle="#fff";
      ctx.font="18px monospace";
      ctx.fillText("A strange blob speaks...", canvas.width/2, 115);

      ctx.font="14px monospace";
      ctx.fillText('"I can open a door... but every door has a price."', canvas.width/2, 155);

      ctx.fillText("1) Ask for light", canvas.width/2, 200);
      ctx.fillText("2) Ask for power", canvas.width/2, 225);
      ctx.fillText("3) Ask for truth", canvas.width/2, 250);

      ctx.fillText("(Press 1/2/3. ESC to leave.)", canvas.width/2, 285);
      return;
    }

    // PLAY STATE DRAW
    // blocks
    for(const b of levels[level].blocks) drawPlatform(b);

    // voids
    ctx.fillStyle="rgba(0,0,0,0.85)";
    for(const v of levels[level].voids){
      ctx.fillRect(v.x,v.y,v.w,v.h);
    }

    // spikes
    for(const s of levels[level].spikes) drawSpikes(s);

    // portals
    for(const p of levels[level].portals){
      if(p.type==="heaven") ctx.fillStyle="rgba(127,255,212,0.9)";
      else if(p.type==="hell") ctx.fillStyle="rgba(255,60,60,0.95)";
      else ctx.fillStyle="rgba(220,220,220,0.55)";
      ctx.fillRect(p.x,p.y,p.w,p.h);

      // glow
      ctx.fillStyle="rgba(255,255,255,0.15)";
      ctx.fillRect(p.x-2,p.y-2,p.w+4,p.h+4);
    }

    // blob npc
    for(const bl of levels[level].blobs){
      drawGlowCircle(bl.x+bl.w/2, bl.y+bl.h/2, 12, 0.18);
      ctx.fillStyle="rgba(141,255,106,0.9)";
      ctx.fillRect(bl.x,bl.y,bl.w,bl.h);
      ctx.fillStyle="rgba(255,255,255,0.35)";
      ctx.fillRect(bl.x+4, bl.y+5, 3, 3);
    }

    // ghost (more aesthetic)
    const bob = Math.sin(t*0.08)*2;
    const gx = player.x;
    const gy = player.y + bob;

    drawGlowCircle(gx+player.w/2, gy+player.h/2, 18, 0.14);
    drawGlowCircle(gx+player.w/2, gy+player.h/2, 10, 0.20);

    ctx.fillStyle="rgba(255,255,255,0.85)";
    ctx.beginPath();
    ctx.roundRect(gx, gy, player.w, player.h, 6);
    ctx.fill();

    // eyes
    ctx.fillStyle="rgba(40,20,70,0.8)";
    ctx.fillRect(gx+4, gy+6, 3, 3);
    ctx.fillRect(gx+9, gy+6, 3, 3);

    // UI
    ctx.fillStyle="rgba(0,0,0,0.35)";
    ctx.fillRect(8,8,240,52);
    ctx.fillStyle="#fff";
    ctx.font="12px monospace";
    ctx.textAlign="left";
    ctx.fillText("Room: "+levels[level].name, 16, 24);
    ctx.fillText("A/D move  SPACE jump", 16, 40);
    ctx.fillText("Hint: touch TOP edge = rare ending", 16, 56);
  }

  /* ---------- LOOP ---------- */
  function loop(){
    update();
    updateBlob();
    draw();
    requestAnimationFrame(loop);
  }
  loop();
};
</script>

</body>
</html>
