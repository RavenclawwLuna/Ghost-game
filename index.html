<!DOCTYPE html>
<html>
<head>
  <title>Ghost Afterlife Obby</title>
  <style>
    body {
      margin: 0;
      background: #0b0b14;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      image-rendering: pixelated;
      overflow: hidden;
    }
    canvas {
      border: 4px solid white;
      background: #111;
    }
  </style>
</head>
<body>

<canvas id="game" width="640" height="360" tabindex="1"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.focus();

/* ---------- INPUT ---------- */
let keys = {};
let jumpRequest = false;

document.addEventListener("keydown", e => {
  keys[e.code] = true;
  if (e.code === "Space") {
    jumpRequest = true;
    e.preventDefault();
  }
});
document.addEventListener("keyup", e => keys[e.code] = false);

/* ---------- PLAYER ---------- */
const GRAVITY = 0.5;

let player = {
  x: 40, y: 260,
  w: 16, h: 16,
  vy: 0,
  onGround: false
};

let level = 0;

/* ---------- LEVELS ---------- */
const levels = [
  // 0 â€” START / CHOICE
  {
    blocks: [
      {x:0,y:300,w:640,h:60},
      {x:120,y:260,w:80,h:20},
      {x:260,y:230,w:80,h:20},
      {x:400,y:200,w:80,h:20}
    ],
    portals: [
      {x:520,y:260,w:20,h:40,to:1}, // fake heaven
      {x:520,y:200,w:20,h:40,to:4}  // hell
    ]
  },

  // 1 â€” FAKE HEAVEN HUB
  {
    blocks: [
      {x:0,y:300,w:800,h:60},
      {x:160,y:250,w:50,h:20},
      {x:260,y:210,w:50,h:20},
      {x:360,y:170,w:50,h:20}
    ],
    fakeDoor: {x:480,y:220,w:20,h:40}
  },

  // 2 â€” LEFT EDGE TRAP ROOM
  {
    blocks: [
      {x:0,y:300,w:640,h:60},
      {x:200,y:240,w:60,h:20},
      {x:300,y:200,w:60,h:20}
    ],
    portals: [{x:560,y:260,w:20,h:40,to:3}]
  },

  // 3 â€” PUZZLE PATH
  {
    blocks: [
      {x:0,y:300,w:640,h:60},
      {x:140,y:260,w:60,h:20},
      {x:240,y:220,w:60,h:20},
      {x:340,y:180,w:60,h:20}
    ],
    portals: [{x:420,y:160,w:20,h:40,to:6}]
  },

  // 4 â€” HELL
  {
    blocks: [
      {x:0,y:300,w:640,h:60},
      {x:240,y:260,w:160,h:20}
    ],
    portals: [{x:520,y:260,w:20,h:40,type:"hell"}]
  },

  // 5 â€” FALL PUNISHMENT ROOM
  {
    blocks: [
      {x:0,y:300,w:640,h:60}
    ],
    portals: [{x:300,y:260,w:20,h:40,to:2}]
  },

  // 6 â€” TRUE HEAVEN OBBY
  {
    blocks: [
      {x:0,y:300,w:640,h:60},
      {x:180,y:260,w:60,h:20},
      {x:260,y:230,w:60,h:20},
      {x:340,y:200,w:60,h:20}
    ],
    portals: [
      {x:360,y:160,w:20,h:40,type:"heaven"} // reachable door
    ]
  }
];

/* ---------- HELPERS ---------- */
function hit(a,b){
  return a.x < b.x+b.w && a.x+a.w > b.x &&
         a.y < b.y+b.h && a.y+a.h > b.y;
}

function reset(){
  player.x = 40;
  player.y = 260;
  player.vy = 0;
}

/* ---------- UPDATE ---------- */
function update(){
  if (keys["KeyA"]) player.x -= 2;
  if (keys["KeyD"]) player.x += 2;

  player.vy += GRAVITY;
  player.y += player.vy;
  player.onGround = false;

  levels[level].blocks.forEach(b=>{
    if (hit(player,b) && player.vy >= 0){
      player.y = b.y - player.h;
      player.vy = 0;
      player.onGround = true;
    }
  });

  if (jumpRequest && player.onGround){
    player.vy = -9;
  }
  jumpRequest = false;

  // portals
  if (levels[level].portals){
    levels[level].portals.forEach(p=>{
      if (hit(player,p)){
        if (p.type === "hell"){
          alert("ðŸ”¥ You fell for the lie. Hell awaits ðŸ”¥");
          level = 0; reset();
        }
        else if (p.type === "heaven"){
          alert("âœ¨ You found the real Heaven âœ¨");
          level = 0; reset();
        }
        else {
          level = p.to;
          reset();
        }
      }
    });
  }

  // EDGE TRANSITIONS
  if (player.x < 0) { level = 2; reset(); }
  if (player.x > canvas.width) { level = 3; reset(); }
  if (player.y > canvas.height) { level = 5; reset(); }
}

/* ---------- DRAW ---------- */
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  ctx.fillStyle = "#ddd";
  ctx.fillRect(player.x,player.y,player.w,player.h);

  ctx.fillStyle = "#444";
  levels[level].blocks.forEach(b=>{
    ctx.fillRect(b.x,b.y,b.w,b.h);
  });

  if (levels[level].portals){
    levels[level].portals.forEach(p=>{
      ctx.fillStyle =
        p.type==="heaven" ? "#7fffd4" :
        p.type==="hell" ? "#ff5555" :
        "#aaa";
      ctx.fillRect(p.x,p.y,p.w,p.h);
    });
  }

  if (levels[level].fakeDoor){
    const d = levels[level].fakeDoor;
    ctx.fillStyle = "#7fffd4";
    ctx.fillRect(d.x,d.y,d.w,d.h);
    ctx.fillStyle = "#fff";
    ctx.fillText("ENTER", d.x - 10, d.y - 5);
  }

  ctx.fillStyle = "#fff";
  ctx.fillText("A / D move   SPACE jump", 10, 20);
}

/* ---------- LOOP ---------- */
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
