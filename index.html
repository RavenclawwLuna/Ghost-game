<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Afterlife Obby</title>
<style>
body{
  margin:0;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background: radial-gradient(circle at 50% 40%, #1b1b3a 0%, #070712 70%);
  font-family: monospace;
  overflow:hidden;
}
canvas{
  width:960px;
  height:540px;
  border-radius:16px;
  box-shadow: 0 20px 80px rgba(0,0,0,0.65);
  border:2px solid rgba(255,255,255,0.12);
  image-rendering: pixelated;
  background:#0b0b16;
}
</style>
</head>
<body>
<canvas id="game" width="640" height="360"></canvas>

<script>
window.onload = () => {
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let state = "intro";
let keys = {};
let jumpRequest = false;
let humanUnlocked = false; // üîê NEW

const GRAVITY = 0.5;

let player = { x:40, y:260, w:16, h:18, vy:0, onGround:false };
let level = 0;
let respawn = { x:40, y:260 };

let activeBlob = null;
let blobChoice = 0;

function clamp(n,a,b){ return Math.max(a,Math.min(b,n)); }
function hit(a,b){
  return (a.x < b.x+b.w && a.x+a.w > b.x &&
          a.y < b.y+b.h && a.y+a.h > b.y);
}

function resetToLevel(lv){
  // üö´ Prevent cheating Human levels
  if((lv===23 || lv===24) && !humanUnlocked) return;

  level = lv;
  const r = levels[level].respawn;
  player.x = r.x;
  player.y = r.y;
  player.vy = 0;
  player.onGround = false;
  respawn.x = player.x;
  respawn.y = player.y;
}

function respawnStart(){ resetToLevel(0); }
function respawnHere(){
  player.x = respawn.x;
  player.y = respawn.y;
  player.vy = 0;
  player.onGround = false;
}

/* ================= LEVELS ================= */
/* üî¥ ALL ORIGINAL LEVELS UNCHANGED */
/* üîΩ ONLY NEW LEVELS ARE 23 + 24 */

const levels = [
/* --- YOUR ORIGINAL LEVELS 0‚Äì22 GO HERE UNCHANGED --- */

/* ================= NEW HUMAN LEVELS ================= */

// 23 ‚Äî HUMAN TRIAL OBBY
{
  respawn:{x:40,y:260},
  decor:"sky",
  blocks:[
    {x:0,y:300,w:640,h:60},
    {x:120,y:250,w:100,h:16},
    {x:260,y:200,w:100,h:16},
    {x:400,y:150,w:100,h:16},
    {x:520,y:100,w:100,h:16}
  ],
  portals:[],
  voids:[{x:0,y:300,w:640,h:60}],
  spikes:[],
  blobs:[],
  topGate:true,
  topTo:24,
  edges:{ left:23,right:23,top:24,bottom:23 }
},

// 24 ‚Äî HUMAN ANTECHAMBER (ONLY HUMAN PORTAL)
{
  respawn:{x:40,y:260},
  decor:"city",
  blocks:[
    {x:0,y:300,w:640,h:60},
    {x:240,y:260,w:160,h:16}
  ],
  portals:[
    {x:580,y:220,w:24,h:48,type:"human"}
  ],
  voids:[],
  spikes:[],
  blobs:[],
  edges:{ left:24,right:24,top:24,bottom:24 }
}
];

/* ================= INPUT ================= */
addEventListener("keydown", e=>{
keys[e.code]=true;

if(state==="intro" && e.code==="Space"){
  state="play";
  resetToLevel(0);
}

if(e.code==="Space") jumpRequest=true;

if(state==="blob"){
  if(e.code==="Digit1") blobChoice = 1;
  if(e.code==="Digit2") blobChoice = 2;
}
});
addEventListener("keyup", e=>keys[e.code]=false);

/* ================= UPDATE ================= */
function update(){
if(state!=="play") return;

const L = levels[level];

if(keys["KeyA"]) player.x -= 2;
if(keys["KeyD"]) player.x += 2;

player.vy += GRAVITY;
player.y += player.vy;
player.onGround = false;

for(const b of L.blocks){
  if(hit(player,b) && player.vy>=0){
    player.y = b.y - player.h;
    player.vy = 0;
    player.onGround = true;
    respawn.x = player.x;
    respawn.y = player.y;
  }
}

if(jumpRequest && player.onGround) player.vy = -9;
jumpRequest = false;

if(L.topGate && player.y <= 0){
  resetToLevel(L.topTo);
  return;
}

for(const v of L.voids){
  if(hit(player,v)){ respawnHere(); return; }
}

for(const s of L.spikes){
  if(hit(player,s)){ respawnStart(); return; }
}

for(const bl of L.blobs){
  if(hit(player,bl)){
    state="blob";
    activeBlob = bl;
    blobChoice = 0;
    return;
  }
}

for(const p of L.portals){
  if(hit(player,p)){
    if(p.type==="heaven"){ state="heaven"; return; }
    if(p.type==="hell"){ state="hell"; return; }
    if(p.type==="human"){ state="human"; return; }
  }
}

player.x = clamp(player.x,-80,canvas.width+80);
}

/* ================= BLOB LOGIC ================= */
function updateBlob(){
if(state!=="blob" || !activeBlob) return;

// üü¢ SPECIFIC GREEN BLOB ‚Üí HUMAN UNLOCK
if(
  activeBlob.color === "#6affc8" &&
  activeBlob.q === "Do you follow the light?" &&
  blobChoice === 2
){
  humanUnlocked = true;
  state="play";
  resetToLevel(23); // Human Trial Obby
}
else if(blobChoice === 1){
  state="play";
  resetToLevel(activeBlob.a);
}
else if(blobChoice === 2){
  state="play";
  resetToLevel(activeBlob.b);
}

blobChoice = 0;
activeBlob = null;
}

/* ================= DRAW ================= */
/* üî¥ YOUR ORIGINAL DRAW CODE GOES HERE UNCHANGED */
/* INCLUDING HEAVEN / HELL / HUMAN END TEXT */

function loop(){
update();
updateBlob();
draw();
requestAnimationFrame(loop);
}
loop();
};
</script>
</body>
</html>
