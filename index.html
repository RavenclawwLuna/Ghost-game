<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Afterlife Obby</title>
  <style>
    body{
      margin:0;
      height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      background: radial-gradient(circle at 50% 40%, #1b1b3a 0%, #070712 70%);
      font-family: monospace;
      overflow:hidden;
    }
    canvas{
      width:960px;
      height:540px;
      border-radius:16px;
      box-shadow: 0 20px 80px rgba(0,0,0,0.65);
      border:2px solid rgba(255,255,255,0.12);
      image-rendering: pixelated;
      background:#0b0b16;
    }
  </style>
</head>
<body>
<canvas id="game" width="640" height="360"></canvas>

<script>
window.onload = () => {
  const canvas = document.getElementById("game");
  const ctx = canvas.getContext("2d");

  let state = "intro"; // intro, play, blob, heaven, hell, human
  let keys = {};
  let jumpRequest = false;

  const GRAVITY = 0.5;

  let player = { x:40, y:260, w:16, h:18, vy:0, onGround:false };
  let level = 0;
  let respawn = { x:40, y:260 };

  // blob UI
  let activeBlob = null; // {a,b,color,q,c1,c2}
  let blobChoice = 0;

  function clamp(n,a,b){ return Math.max(a,Math.min(b,n)); }

  function hit(a,b){
    return (a.x < b.x+b.w && a.x+a.w > b.x &&
            a.y < b.y+b.h && a.y+a.h > b.y);
  }

  function resetToLevel(lv){
    level = lv;
    const r = levels[level].respawn;
    player.x = r.x;
    player.y = r.y;
    player.vy = 0;
    player.onGround = false;
    respawn.x = player.x;
    respawn.y = player.y;
  }

  function respawnStart(){
    resetToLevel(0);
  }

  function respawnHere(){
    player.x = respawn.x;
    player.y = respawn.y;
    player.vy = 0;
    player.onGround = false;
  }

  // ---------- ROOMS ----------
  const levels = [
    // 0 START
    {
      respawn:{x:40,y:260},
      decor:"stars",
      blocks:[
        {x:0,y:300,w:640,h:60},
        {x:120,y:270,w:90,h:16},
        {x:250,y:250,w:90,h:16},
        {x:380,y:230,w:90,h:16},
        {x:520,y:260,w:90,h:16},
        {x:40,y:235,w:90,h:14}
      ],
      portals:[
        {x:620,y:260,w:20,h:40,to:1},
        {x:0,y:260,w:20,h:40,to:2}
      ],
      voids:[
        {x:210,y:300,w:80,h:60}
      ],
      spikes:[
        {x:310,y:292,w:30,h:8}
      ],
      blobs:[
        {x:70,y:284,w:16,h:16,color:"#ff6ad5",a:4,b:5,
          q:"Do you forgive?",
          c1:"Yes",
          c2:"No"
        },
        {x:550,y:284,w:16,h:16,color:"#6affc8",a:3,b:6,
          q:"Do you follow the light?",
          c1:"Follow",
          c2:"Ignore"
        }
      ]
    },

    // 1 HALL
    {
      respawn:{x:40,y:260},
      decor:"lanterns",
      blocks:[
        {x:0,y:300,w:640,h:60},
        {x:90,y:265,w:80,h:16},
        {x:220,y:245,w:80,h:16},
        {x:350,y:225,w:80,h:16},
        {x:480,y:205,w:80,h:16},
        {x:560,y:260,w:70,h:16}
      ],
      portals:[
        {x:620,y:260,w:20,h:40,to:7},
        {x:0,y:260,w:20,h:40,to:0}
      ],
      voids:[
        {x:280,y:300,w:140,h:60}
      ],
      spikes:[
        {x:150,y:292,w:30,h:8},
        {x:500,y:292,w:30,h:8}
      ],
      blobs:[
        {x:320,y:284,w:16,h:16,color:"#ffb86a",a:8,b:9,
          q:"Do you lie?",
          c1:"Lie",
          c2:"Truth"
        }
      ]
    },

    // 2 STAIRS
    {
      respawn:{x:40,y:260},
      decor:"clouds",
      blocks:[
        {x:0,y:300,w:640,h:60},
        {x:90,y:270,w:80,h:16},
        {x:190,y:245,w:80,h:16},
        {x:290,y:220,w:80,h:16},
        {x:390,y:195,w:80,h:16},
        {x:490,y:170,w:110,h:16}
      ],
      portals:[
        {x:620,y:260,w:20,h:40,to:0},
        {x:0,y:260,w:20,h:40,to:10}
      ],
      voids:[
        {x:0,y:300,w:50,h:60}
      ],
      spikes:[
        {x:455,y:292,w:30,h:8}
      ],
      blobs:[
        {x:120,y:284,w:16,h:16,color:"#8da2ff",a:11,b:12,
          q:"Do you keep going?",
          c1:"Go",
          c2:"Stop"
        }
      ]
    },

    // 3 WHISPER A
    {
      respawn:{x:40,y:260},
      decor:"mushrooms",
      blocks:[
        {x:0,y:300,w:640,h:60},
        {x:140,y:265,w:90,h:16},
        {x:270,y:240,w:90,h:16},
        {x:400,y:215,w:90,h:16},
        {x:520,y:260,w:90,h:16}
      ],
      portals:[
        {x:620,y:260,w:20,h:40,to:0},
        {x:620,y:0,w:20,h:360,to:6}
      ],
      voids:[
        {x:300,y:300,w:80,h:60}
      ],
      spikes:[
        {x:200,y:292,w:30,h:8}
      ],
      blobs:[
        {x:60,y:284,w:16,h:16,color:"#6affc8",a:6,b:5,
          q:"Do you listen?",
          c1:"Listen",
          c2:"Run"
        }
      ]
    },

    // 4 WHISPER B
    {
      respawn:{x:40,y:260},
      decor:"bones",
      blocks:[
        {x:0,y:300,w:640,h:60},
        {x:120,y:265,w:80,h:16},
        {x:240,y:240,w:80,h:16},
        {x:360,y:215,w:80,h:16},
        {x:480,y:190,w:80,h:16},
        {x:560,y:260,w:70,h:16}
      ],
      portals:[
        {x:620,y:260,w:20,h:40,to:0},
        {x:0,y:260,w:20,h:40,to:5}
      ],
      voids:[
        {x:240,y:300,w:160,h:60}
      ],
      spikes:[
        {x:160,y:292,w:30,h:8},
        {x:480,y:292,w:30,h:8}
      ],
      blobs:[
        {x:520,y:284,w:16,h:16,color:"#ff6ad5",a:5,b:6,
          q:"Do you steal?",
          c1:"Take",
          c2:"Leave"
        }
      ]
    },

    // 5 CINDERS
    {
      respawn:{x:40,y:260},
      decor:"embers",
      blocks:[
        {x:0,y:300,w:640,h:60},
        {x:140,y:270,w:90,h:16},
        {x:270,y:250,w:90,h:16},
        {x:400,y:230,w:90,h:16},
        {x:520,y:210,w:90,h:16}
      ],
      portals:[
        {x:620,y:260,w:20,h:40,to:9},
        {x:0,y:260,w:20,h:40,to:0}
      ],
      voids:[
        {x:320,y:300,w:80,h:60}
      ],
      spikes:[
        {x:90,y:292,w:30,h:8},
        {x:560,y:292,w:30,h:8}
      ],
      blobs:[]
    },

    // 6 SKY EDGE (touch top -> human room)
    {
      respawn:{x:40,y:260},
      decor:"sky",
      blocks:[
        {x:0,y:300,w:640,h:60},
        {x:120,y:270,w:90,h:16},
        {x:250,y:240,w:90,h:16},
        {x:380,y:210,w:90,h:16},
        {x:510,y:180,w:90,h:16}
      ],
      portals:[
        {x:0,y:260,w:20,h:40,to:3}
      ],
      voids:[
        {x:0,y:300,w:50,h:60}
      ],
      spikes:[
        {x:300,y:292,w:30,h:8}
      ],
      blobs:[],
      topGate:true,
      topTo:13
    },

    // 7 HELL MAZE ENTRY
    {
      respawn:{x:40,y:260},
      decor:"chains",
      blocks:[
        {x:0,y:300,w:640,h:60},
        {x:100,y:270,w:90,h:16},
        {x:240,y:240,w:90,h:16},
        {x:380,y:210,w:90,h:16},
        {x:520,y:240,w:90,h:16}
      ],
      portals:[
        {x:600,y:240,w:20,h:60,to:8},
        {x:20,y:240,w:20,h:60,to:9},
        {x:0,y:260,w:20,h:40,to:1}
      ],
      voids:[
        {x:260,y:300,w:120,h:60}
      ],
      spikes:[
        {x:420,y:292,w:30,h:8}
      ],
      blobs:[]
    },

    // 8 DEEP HELL (real hell door)
    {
      respawn:{x:40,y:260},
      decor:"lava",
      blocks:[
        {x:0,y:300,w:640,h:60},
        {x:160,y:260,w:90,h:16},
        {x:300,y:230,w:90,h:16},
        {x:440,y:200,w:90,h:16}
      ],
      portals:[
        {x:600,y:240,w:20,h:60,type:"hell"},
        {x:0,y:260,w:20,h:40,to:7}
      ],
      voids:[
        {x:220,y:300,w:200,h:60}
      ],
      spikes:[
        {x:100,y:292,w:30,h:8},
        {x:520,y:292,w:30,h:8}
      ],
      blobs:[]
    },

    // 9 JUDGMENT (another hell door)
    {
      respawn:{x:40,y:260},
      decor:"skulls",
      blocks:[
        {x:0,y:300,w:640,h:60},
        {x:140,y:270,w:90,h:16},
        {x:300,y:240,w:90,h:16},
        {x:460,y:210,w:90,h:16}
      ],
      portals:[
        {x:560,y:160,w:20,h:60,type:"hell"},
        {x:0,y:260,w:20,h:40,to:7}
      ],
      voids:[
        {x:220,y:300,w:120,h:60}
      ],
      spikes:[
        {x:320,y:292,w:30,h:8}
      ],
      blobs:[]
    },

    // 10 HEAVEN CHAIN 1
    {
      respawn:{x:40,y:260},
      decor:"lilies",
      blocks:[
        {x:0,y:300,w:640,h:60},
        {x:140,y:270,w:90,h:16},
        {x:270,y:240,w:90,h:16},
        {x:400,y:210,w:90,h:16},
        {x:520,y:180,w:90,h:16}
      ],
      portals:[
        {x:620,y:260,w:20,h:40,to:11},
        {x:0,y:260,w:20,h:40,to:2}
      ],
      voids:[
        {x:300,y:300,w:120,h:60}
      ],
      spikes:[
        {x:520,y:292,w:30,h:8}
      ],
      blobs:[]
    },

    // 11 HEAVEN CHAIN 2
    {
      respawn:{x:40,y:260},
      decor:"aurora",
      blocks:[
        {x:0,y:300,w:640,h:60},
        {x:140,y:270,w:90,h:16},
        {x:270,y:235,w:90,h:16},
        {x:400,y:200,w:90,h:16},
        {x:520,y:165,w:90,h:16}
      ],
      portals:[
        {x:620,y:260,w:20,h:40,to:12},
        {x:0,y:260,w:20,h:40,to:10}
      ],
      voids:[
        {x:260,y:300,w:160,h:60}
      ],
      spikes:[
        {x:180,y:292,w:30,h:8},
        {x:460,y:292,w:30,h:8}
      ],
      blobs:[]
    },

    // 12 REAL HEAVEN DOOR ROOM
    {
      respawn:{x:40,y:260},
      decor:"garden",
      blocks:[
        {x:0,y:300,w:640,h:60},
        {x:140,y:270,w:90,h:16},
        {x:270,y:240,w:90,h:16},
        {x:400,y:210,w:90,h:16},
        {x:500,y:180,w:120,h:16}
      ],
      portals:[
        {x:560,y:132,w:24,h:48,type:"heaven"},
        {x:0,y:260,w:20,h:40,to:11}
      ],
      voids:[
        {x:0,y:300,w:60,h:60}
      ],
      spikes:[
        {x:500,y:292,w:30,h:8}
      ],
      blobs:[]
    },

    // 13 HUMAN OBBY ROOM
    {
      respawn:{x:40,y:260},
      decor:"city",
      blocks:[
        {x:0,y:300,w:640,h:60},
        {x:120,y:270,w:90,h:16},
        {x:250,y:240,w:90,h:16},
        {x:380,y:210,w:90,h:16},
        {x:510,y:180,w:90,h:16},
        {x:560,y:120,w:60,h:16}
      ],
      portals:[
        {x:580,y:72,w:24,h:48,type:"human"},
        {x:0,y:260,w:20,h:40,to:6}
      ],
      voids:[
        {x:280,y:300,w:120,h:60}
      ],
      spikes:[
        {x:360,y:292,w:30,h:8}
      ],
      blobs:[]
    }
  ];

  // ---------- INPUT ----------
  addEventListener("keydown", e=>{
    keys[e.code]=true;

    if(state==="intro" && e.code==="Space"){
      state="play";
      resetToLevel(0);
    }

    if(e.code==="Space") jumpRequest=true;

    if(state==="blob"){
      if(e.code==="Digit1") blobChoice = 1;
      if(e.code==="Digit2") blobChoice = 2;
      if(e.code==="Escape"){
        state="play";
        blobChoice=0;
        activeBlob=null;
      }
    }
  });

  addEventListener("keyup", e=>keys[e.code]=false);

  // ---------- UPDATE ----------
  function update(){
    if(state!=="play") return;

    const L = levels[level];

    if(keys["KeyA"]) player.x -= 2;
    if(keys["KeyD"]) player.x += 2;

    player.vy += GRAVITY;
    player.y += player.vy;
    player.onGround = false;

    // collisions
    for(const b of L.blocks){
      if(hit(player,b)){
        if(player.vy >= 0 && player.y + player.h - player.vy <= b.y + 5){
          player.y = b.y - player.h;
          player.vy = 0;
          player.onGround = true;
          respawn.x = player.x;
          respawn.y = player.y;
        }
      }
    }

    // jump
    if(jumpRequest && player.onGround){
      player.vy = -9;
    }
    jumpRequest = false;

    // top gate teleport
    if(L.topGate && player.y <= 0){
      resetToLevel(L.topTo);
      return;
    }

    // void -> respawn in room
    for(const v of L.voids){
      if(hit(player,v)){ respawnHere(); return; }
    }

    // spikes -> respawn to start
    for(const s of L.spikes){
      if(hit(player,s)){ respawnStart(); return; }
    }

    // blobs
    for(const bl of L.blobs){
      if(hit(player,bl)){
        state="blob";
        activeBlob = bl;
        blobChoice=0;
        return;
      }
    }

    // portals
    for(const p of L.portals){
      if(hit(player,p)){
        if(p.type==="heaven"){ state="heaven"; return; }
        if(p.type==="hell"){ state="hell"; return; }
        if(p.type==="human"){ state="human"; return; }
        if(p.to!==undefined){ resetToLevel(p.to); return; }
      }
    }

    // fall -> hell
    if(player.y > canvas.height + 50){
      state="hell";
      return;
    }

    player.x = clamp(player.x,-40,canvas.width+40);
  }

  function updateBlob(){
    if(state!=="blob" || !activeBlob) return;

    if(blobChoice===1){
      state="play";
      resetToLevel(activeBlob.a);
      blobChoice=0;
      activeBlob=null;
    }else if(blobChoice===2){
      state="play";
      resetToLevel(activeBlob.b);
      blobChoice=0;
      activeBlob=null;
    }
  }

  // ---------- DRAW HELPERS ----------
  function drawGlowRect(x,y,w,h,fill,glow){
    ctx.save();
    ctx.shadowBlur = glow;
    ctx.shadowColor = fill;
    ctx.fillStyle = fill;
    ctx.fillRect(x,y,w,h);
    ctx.restore();
  }

  function drawSpikes(s){
    ctx.save();
    ctx.fillStyle = "#ff3b3b";
    ctx.shadowBlur = 10;
    ctx.shadowColor = "#ff3b3b";
    const n = Math.max(1, Math.floor(s.w/6));
    for(let i=0;i<n;i++){
      const px = s.x + i*6;
      ctx.beginPath();
      ctx.moveTo(px, s.y+s.h);
      ctx.lineTo(px+3, s.y);
      ctx.lineTo(px+6, s.y+s.h);
      ctx.closePath();
      ctx.fill();
    }
    ctx.restore();
  }

  function drawDecor(type){
    ctx.save();
    if(type==="stars"){
      ctx.globalAlpha=0.8;
      for(let i=0;i<40;i++){
        const x = (i*97)%640;
        const y = (i*53)%220;
        ctx.fillStyle = (i%3===0) ? "#b8b8ff" : "#ffffff";
        ctx.fillRect(x,y,1,1);
      }
    }else if(type==="lanterns"){
      for(let i=0;i<6;i++){
        const x=60+i*100, y=60+(i%2)*20;
        drawGlowRect(x,y,4,14,"#ffd28d",12);
      }
    }else if(type==="clouds"){
      ctx.globalAlpha=0.25;
      ctx.fillStyle="#d8f3ff";
      ctx.fillRect(60,60,80,18);
      ctx.fillRect(260,40,120,20);
      ctx.fillRect(420,70,90,16);
    }else if(type==="embers"){
      for(let i=0;i<25;i++){
        const x=(i*71)%640, y=40+((i*39)%200);
        ctx.globalAlpha=0.25;
        drawGlowRect(x,y,2,2,"#ff8a3b",10);
      }
    }else if(type==="mushrooms"){
      ctx.globalAlpha=0.35;
      drawGlowRect(80,285,6,10,"#ff6ad5",10);
      drawGlowRect(520,285,6,10,"#6affc8",10);
    }else if(type==="aurora"){
      ctx.globalAlpha=0.18;
      ctx.fillStyle="#8da2ff";
      ctx.fillRect(0,40,640,40);
      ctx.fillStyle="#6affc8";
      ctx.fillRect(0,70,640,30);
    }else if(type==="garden"){
      ctx.globalAlpha=0.25;
      ctx.fillStyle="#6affc8";
      ctx.fillRect(0,292,640,8);
      drawGlowRect(40,280,3,12,"#ffffff",10);
      drawGlowRect(600,280,3,12,"#ffffff",10);
    }else if(type==="city"){
      ctx.globalAlpha=0.25;
      ctx.fillStyle="#ffffff";
      ctx.fillRect(60,250,20,50);
      ctx.fillRect(100,230,30,70);
      ctx.fillRect(160,240,18,60);
    }else if(type==="sky"){
      ctx.globalAlpha=0.2;
      ctx.fillStyle="#66a3ff";
      ctx.fillRect(0,40,640,50);
    }
    ctx.restore();
  }

  // safe ghost drawing (no roundRect)
  function drawGhost(px,py,w,h){
    ctx.save();
    ctx.shadowBlur=18;
    ctx.shadowColor="#ffffff";
    ctx.fillStyle="rgba(255,255,255,0.85)";

    // head/body
    ctx.beginPath();
    ctx.arc(px+w/2, py+7, 7, Math.PI, 0);
    ctx.lineTo(px+w, py+h-5);
    ctx.quadraticCurveTo(px+w*0.8, py+h, px+w*0.6, py+h-4);
    ctx.quadraticCurveTo(px+w*0.4, py+h, px+w*0.2, py+h-4);
    ctx.quadraticCurveTo(px+w*0.1, py+h, px, py+h-5);
    ctx.closePath();
    ctx.fill();

    // eyes
    ctx.shadowBlur=0;
    ctx.fillStyle="rgba(10,10,20,0.85)";
    ctx.fillRect(px+5, py+8, 2, 2);
    ctx.fillRect(px+11, py+8, 2, 2);

    ctx.restore();
  }

  // ---------- DRAW ----------
  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    if(state==="intro"){
      ctx.fillStyle="#0b0b16";
      ctx.fillRect(0,0,canvas.width,canvas.height);

      ctx.textAlign="center";
      ctx.fillStyle="#fff";
      ctx.font="20px monospace";
      ctx.fillText("AFTERLIFE OBBY", canvas.width/2, 120);

      ctx.font="14px monospace";
      ctx.fillText("A/D move   SPACE jump", canvas.width/2, 170);
      ctx.fillText("Try to get all 3 endings", canvas.width/2, 195);
      ctx.fillText("Press SPACE to start", canvas.width/2, 245);
      return;
    }

    if(state==="heaven"){
      ctx.fillStyle="#ffffff";
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.textAlign="center";
      ctx.fillStyle="#000";
      ctx.font="26px monospace";
      ctx.fillText("HEAVEN", canvas.width/2, 170);
      ctx.font="14px monospace";
      ctx.fillText("3 endings exist", canvas.width/2, 220);
      return;
    }

    if(state==="hell"){
      ctx.fillStyle="#1a0000";
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.textAlign="center";
      ctx.fillStyle="#ff3b3b";
      ctx.font="26px monospace";
      ctx.fillText("HELL", canvas.width/2, 170);
      ctx.font="14px monospace";
      ctx.fillText("3 endings exist", canvas.width/2, 220);
      return;
    }

    if(state==="human"){
      ctx.fillStyle="#0b1a33";
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.textAlign="center";
      ctx.fillStyle="#ffffff";
      ctx.font="26px monospace";
      ctx.fillText("HUMAN", canvas.width/2, 170);
      ctx.font="14px monospace";
      ctx.fillText("3 endings exist", canvas.width/2, 220);
      return;
    }

    if(state==="blob"){
      ctx.fillStyle="#0b0b16";
      ctx.fillRect(0,0,canvas.width,canvas.height);

      ctx.textAlign="center";
      ctx.fillStyle="#fff";
      ctx.font="16px monospace";

      if(activeBlob){
        ctx.fillText(activeBlob.q, canvas.width/2, 120);
        ctx.font="14px monospace";
        ctx.fillText("1: "+activeBlob.c1, canvas.width/2, 180);
        ctx.fillText("2: "+activeBlob.c2, canvas.width/2, 205);
        ctx.font="12px monospace";
        ctx.fillText("(press 1 or 2)", canvas.width/2, 250);
        drawGlowRect(canvas.width/2-8, 140, 16, 16, activeBlob.color, 18);
      }
      return;
    }

    // PLAY
    const L = levels[level];

    const g = ctx.createLinearGradient(0,0,0,360);
    g.addColorStop(0,"#0b0b16");
    g.addColorStop(1,"#06060c");
    ctx.fillStyle=g;
    ctx.fillRect(0,0,canvas.width,canvas.height);

    drawDecor(L.decor);

    ctx.fillStyle="rgba(255,255,255,0.65)";
    ctx.font="12px monospace";
    ctx.textAlign="left";
    ctx.fillText("A/D move   SPACE jump", 10, 18);

    // platforms
    ctx.fillStyle="rgba(255,255,255,0.12)";
    for(const b of L.blocks){
      ctx.fillRect(b.x,b.y,b.w,b.h);
    }

    // voids
    ctx.fillStyle="rgba(0,0,0,0.65)";
    for(const v of L.voids){
      ctx.fillRect(v.x,v.y,v.w,v.h);
    }

    // portals
    for(const p of L.portals){
      if(p.type==="heaven") drawGlowRect(p.x,p.y,p.w,p.h,"#7fffd4",20);
      else if(p.type==="hell") drawGlowRect(p.x,p.y,p.w,p.h,"#ff3b3b",20);
      else if(p.type==="human") drawGlowRect(p.x,p.y,p.w,p.h,"#66a3ff",20);
      else drawGlowRect(p.x,p.y,p.w,p.h,"#ffffff",10);
    }

    // spikes
    for(const s of L.spikes) drawSpikes(s);

    // blobs
    for(const bl of L.blobs){
      drawGlowRect(bl.x, bl.y, bl.w, bl.h, bl.color, 18);
    }

    // ghost
    drawGhost(player.x, player.y, player.w, player.h);
  }

  // ---------- LOOP ----------
  function loop(){
    update();
    updateBlob();
    draw();
    requestAnimationFrame(loop);
  }
  loop();
};
</script>
</body>
</html>
