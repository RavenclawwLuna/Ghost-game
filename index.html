<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Afterlife Obby</title>
<style>
body {
    margin:0;
    height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    background:#0b0b16;
    font-family:monospace;
    overflow:hidden;
}
canvas {
    width:960px;
    height:540px;
    border-radius:12px;
    box-shadow:0 15px 60px rgba(0,0,0,0.7);
    border:2px solid rgba(255,255,255,0.1);
    image-rendering:pixelated;
    background:#0b0b16;
}
</style>
</head>
<body>
<canvas id="game" width="640" height="360"></canvas>
<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let state = "intro";
let keys = {};
let jump = false;

const GRAVITY = 0.5;
let player = {x:40, y:260, w:16, h:18, vy:0, onGround:false};
let respawn = {x:40, y:260};
let level = 0;

function clamp(n,a,b){ return Math.max(a, Math.min(b,n)); }
function hit(a,b){ return(a.x<a.x+b.w && a.x+a.w>b.x && a.y<b.y+b.h && a.y+a.h>b.y); }
function respawnHere(){ player.x=respawn.x; player.y=respawn.y; player.vy=0; player.onGround=false; }
function resetToLevel(lv){ 
    level=lv;
    const r = levels[lv].respawn;
    player.x=r.x; player.y=r.y; player.vy=0; player.onGround=false;
    respawn.x=player.x; respawn.y=player.y;
}

const levels = [
    // Level 0 - Start
    {respawn:{x:40,y:260}, blocks:[
        {x:0,y:300,w:640,h:60},{x:120,y:270,w:90,h:16},{x:250,y:250,w:90,h:16},{x:380,y:230,w:90,h:16}
    ],
    voids:[{x:210,y:300,w:80,h:60}], spikes:[{x:310,y:292,w:30,h:8}],
    blobs:[{x:70,y:284,w:16,h:16,color:"#ff6ad5",a:1,b:2,q:"Go left or right?",c1:"Left",c2:"Right"}],
    portals:[], edges:{left:2,right:1,top:14,bottom:15}},
    // Level 1 - Hell path
    {respawn:{x:40,y:260}, blocks:[
        {x:0,y:300,w:640,h:60},{x:90,y:265,w:80,h:16},{x:220,y:245,w:80,h:16}
    ],
    voids:[{x:280,y:300,w:140,h:60}], spikes:[{x:150,y:292,w:30,h:8}],
    blobs:[], portals:[{x:600,y:230,w:24,h:40,type:"hell"}],
    edges:{left:0,right:0,top:16,bottom:17}},
    // Level 2 - Heaven path
    {respawn:{x:40,y:260}, blocks:[
        {x:0,y:300,w:640,h:60},{x:90,y:270,w:80,h:16},{x:220,y:250,w:80,h:16},{x:350,y:230,w:80,h:16}
    ],
    voids:[], spikes:[{x:455,y:292,w:30,h:8}],
    blobs:[], portals:[{x:580,y:230,w:24,h:40,type:"heaven"}],
    edges:{left:0,right:0,top:18,bottom:19}},
    // Level 3 - Human Obby
    {respawn:{x:40,y:260}, blocks:[
        {x:0,y:300,w:640,h:60},{x:120,y:270,w:90,h:16},{x:250,y:240,w:90,h:16},{x:380,y:210,w:90,h:16},
        {x:510,y:180,w:90,h:16},{x:560,y:120,w:60,h:16},{x:580,y:80,w:40,h:16}
    ],
    voids:[{x:280,y:300,w:120,h:60}], spikes:[{x:360,y:292,w:30,h:8}],
    blobs:[], portals:[{x:590,y:40,w:24,h:40,type:"human"}], edges:{left:6,right:6,top:6,bottom:6}}
];

let activeBlob = null;
let blobChoice = 0;

// Input
addEventListener("keydown", e=>{
    keys[e.code]=true;
    if(state==="intro" && e.code==="Space"){ state="play"; resetToLevel(0); }
    if(e.code==="Space") jump = true;
    if(state==="blob"){
        if(e.code==="Digit1") blobChoice=1;
        if(e.code==="Digit2") blobChoice=2;
        if(e.code==="Escape"){ state="play"; blobChoice=0; activeBlob=null; }
    }
});
addEventListener("keyup", e=>keys[e.code]=false);

// Update
function update(){
    if(state!=="play") return;
    const L = levels[level];
    if(keys["KeyA"]) player.x-=2;
    if(keys["KeyD"]) player.x+=2;

    player.vy+=GRAVITY;
    player.y+=player.vy;
    player.onGround=false;

    for(const b of L.blocks){
        if(hit(player,b)){
            if(player.vy>=0 && player.y+player.h-player.vy<=b.y+5){
                player.y=b.y-player.h;
                player.vy=0;
                player.onGround=true;
                respawn.x=player.x; respawn.y=player.y;
            }
        }
    }

    if(jump && player.onGround) player.vy=-9;
    jump=false;

    for(const v of L.voids) if(hit(player,v)) respawnHere();
    for(const s of L.spikes) if(hit(player,s)) resetToLevel(0);
    for(const bl of L.blobs) if(hit(player,bl)) {state="blob"; activeBlob=bl; blobChoice=0; return;}
    for(const p of L.portals) if(hit(player,p)){
        if(p.type==="heaven") state="heaven";
        if(p.type==="hell") state="hell";
        if(p.type==="human") state="human";
        if(p.to!==undefined) resetToLevel(p.to);
        return;
    }

    if(L.edges){
        if(player.x+player.w<0){ resetToLevel(L.edges.left); player.x=canvas.width-40; return; }
        if(player.x>canvas.width){ resetToLevel(L.edges.right); player.x=40; return; }
        if(player.y+player.h<0){ resetToLevel(L.edges.top); player.y=canvas.height-80; return; }
        if(player.y>canvas.height){ resetToLevel(L.edges.bottom); player.y=40; return; }
    }

    player.x = clamp(player.x,-80,canvas.width+80);
}

// Blob choice
function updateBlob(){
    if(state!=="blob" || !activeBlob) return;
    if(blobChoice===1){ state="play"; resetToLevel(activeBlob.a); blobChoice=0; activeBlob=null; }
    else if(blobChoice===2){ state="play"; resetToLevel(activeBlob.b); blobChoice=0; activeBlob=null; }
}

// Draw helpers
function drawGlowRect(x,y,w,h,fill,glow){
    ctx.save();
    ctx.shadowBlur=glow; ctx.shadowColor=fill;
    ctx.fillStyle=fill; ctx.fillRect(x,y,w,h);
    ctx.restore();
}

function drawSpikes(s){
    ctx.save();
    ctx.fillStyle="#ff3b3b";
    ctx.shadowBlur=10; ctx.shadowColor="#ff3b3b";
    const n=Math.max(1,Math.floor(s.w/6));
    for(let i=0;i<n;i++){
        const px=s.x+i*6;
        ctx.beginPath();
        ctx.moveTo(px,s.y+s.h);
        ctx.lineTo(px+3,s.y);
        ctx.lineTo(px+6,s.y+s.h);
        ctx.closePath();
        ctx.fill();
    }
    ctx.restore();
}

function drawGhost(px,py,w,h){
    ctx.save();
    ctx.shadowBlur=18; ctx.shadowColor="#fff"; ctx.fillStyle="rgba(255,255,255,0.85)";
    ctx.beginPath();
    ctx.arc(px+w/2,py+7,7,Math.PI,0);
    ctx.lineTo(px+w,py+h-5);
    ctx.quadraticCurveTo(px+w*0.8,py+h,px+w*0.6,py+h-4);
    ctx.quadraticCurveTo(px+w*0.4,py+h,px+w*0.2,py+h-4);
    ctx.quadraticCurveTo(px+w*0.1,py+h,px,py+h-5);
    ctx.closePath();
    ctx.fill();
    ctx.shadowBlur=0; ctx.fillStyle="rgba(10,10,20,0.85)";
    ctx.fillRect(px+5,py+8,2,2);
    ctx.fillRect(px+11,py+8,2,2);
    ctx.restore();
}

// Draw
function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    if(state==="intro"){
        ctx.fillStyle="#0b0b16"; ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.textAlign="center"; ctx.fillStyle="#fff"; ctx.font="20px monospace";
        ctx.fillText("AFTERLIFE OBBY", canvas.width/2,120);
        ctx.font="14px monospace";
        ctx.fillText("A/D move   SPACE jump", canvas.width/2,170);
        ctx.fillText("Try to get all 3 endings", canvas.width/2,195);
        ctx.fillText("Press SPACE to start", canvas.width/2,245);
        return;
    }

    if(state==="heaven"){
        ctx.fillStyle="white"; ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.fillStyle="#000"; ctx.textAlign="center"; ctx.font="28px monospace";
        ctx.fillText("âœ¨ HEAVEN âœ¨",canvas.width/2,90);
        ctx.font="16px monospace";
        ctx.fillText("You found the real Heaven door.",canvas.width/2,140);
        ctx.fillText("Your soul feels light again.",canvas.width/2,165);
        ctx.fillText("All your choices brought you here.",canvas.width/2,190);
        ctx.fillText("The journey was full of tests.",canvas.width/2,215);
        ctx.font="14px monospace";
        ctx.fillText("Try to unlock all 3 endings.",canvas.width/2,240);
        ctx.fillText("Refresh to play again.",canvas.width/2,270);
        return;
    }

    if(state==="hell"){
        ctx.fillStyle="#ff2f2f"; ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.fillStyle="#000"; ctx.textAlign="center"; ctx.font="28px monospace";
        ctx.fillText("ðŸ”¥ HELL ðŸ”¥",canvas.width/2,90);
        ctx.font="16px monospace";
        ctx.fillText("The wrong path swallowed you.",canvas.width/2,140);
        ctx.fillText("Flames surround your soul.",canvas.width/2,165);
        ctx.fillText("Your choices trapped you here.",canvas.width/2,190);
        ctx.fillText("Perhaps another try will change fate.",canvas.width/2,215);
        ctx.font="14px monospace";
        ctx.fillText("Try to unlock all 3 endings.",canvas.width/2,240);
        ctx.fillText("Refresh to try again.",canvas.width/2,270);
        return;
    }

    if(state==="human"){
        ctx.fillStyle="#0d1b3a"; ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.fillStyle="#bfe9ff"; ctx.textAlign="center"; ctx.font="26px monospace";
        ctx.fillText("ðŸŒŒ HUMAN REALM ðŸŒŒ",canvas.width/2,90);
        ctx.font="16px monospace";
        ctx.fillText("Impossible...",canvas.width/2,140);
        ctx.fillText("You slipped out of judgment.",canvas.width/2,165);
        ctx.fillText("Your ghost returns to the living world.",canvas.width/2,190);
        ctx.fillText("This path is rare and difficult.",canvas.width/2,215);
        ctx.fillText("It took precise steps and choices.",canvas.width/2,240);
        ctx.font="14px monospace";
        ctx.fillText("Try to unlock all 3 endings.",canvas.width/2,265);
        ctx.fillText("Refresh to play again.",canvas.width/2,290);
        return;
    }

    if(state==="blob"){
        ctx.fillStyle="#0b0b16"; ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.textAlign="center"; ctx.fillStyle="#fff"; ctx.font="16px monospace";
        if(activeBlob){
            ctx.fillText(activeBlob.q,canvas.width/2,120);
            ctx.font="14px monospace";
            ctx.fillText("1: "+activeBlob.c1,canvas.width/2,180);
            ctx.fillText("2: "+activeBlob.c2,canvas.width/2,205);
            ctx.font="12px monospace"; ctx.fillText("(press 1 or 2)",canvas.width/2,250);
            drawGlowRect(canvas.width/2-8,140,16,16,activeBlob.color,18);
        }
        return;
    }

    // Draw gameplay
    const L = levels[level];
    ctx.fillStyle="#fff"; // Platforms
    for(const b of L.blocks) ctx.fillRect(b.x,b.y,b.w,b.h);
    ctx.fillStyle="#222"; // voids
    for(const v of L.voids) ctx.fillRect(v.x,v.y,v.w,v.h);
    for(const p of L.portals){
        if(p.type==="heaven") drawGlowRect(p.x,p.y,p.w,p.h,"#7fffd4",20);
        else if(p.type==="hell") drawGlowRect(p.x,p.y,p.w,p.h,"#ff3b3b",20);
        else if(p.type==="human") drawGlowRect(p.x,p.y,p.w,p.h,"#4fd3ff",20);
        else drawGlowRect(p.x,p.y,p.w,p.h,"#fff",10);
    }
    for(const s of L.spikes) drawSpikes(s);
    for(const bl of L.blobs) drawGlowRect(bl.x,bl.y,bl.w,bl.h,bl.color,18);
    drawGhost(player.x,player.y,player.w,player.h);
}

function loop(){ update(); updateBlob(); draw(); requestAnimationFrame(loop); }
loop();
</script>
</body>
</html>
